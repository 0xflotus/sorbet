startup --output_base=/cache/bazel --output_user_root=/cache/bazel_user
common --color yes

test --experimental_multi_threaded_digest --jobs 30
build --experimental_multi_threaded_digest --jobs 30

test --crosstool_top=@llvm_toolchain//:toolchain
build --crosstool_top=@llvm_toolchain//:toolchain

# Bazel links C++ files with $CC, not $CXX, this breaks UBSan
build:sanitize --linkopt=external/llvm_toolchain/lib/clang/7.0.0/lib/linux/libclang_rt.asan_cxx-x86_64.a
test:sanitize --linkopt=external/llvm_toolchain/lib/clang/7.0.0/lib/linux/libclang_rt.asan_cxx-x86_64.a

# flags that substantially increase Clang&LLVMs ability to devirtualize calls
build:lto --copt=-fwhole-program-vtables --copt=-fvisibility=hidden --copt=-fforce-emit-vtables
build:lto --cxxopt=-fwhole-program-vtables --cxxopt=-fvisibility=hidden --cxxopt=-fforce-emit-vtables
build:lto --linkopt=-fwhole-program-vtables --linkopt=-fvisibility=hidden --linkopt=-fforce-emit-vtables
build:lto --linkopt=-Wl,--icf=all

# harden: mark relocation sections read-only
build:release --linkopt=-Wl,-z,relro,-z,now
