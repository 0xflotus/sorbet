---
id: rbi
title: RBI Files
---

> This section is specific to Stripe right now. It is currently unknown how to
> reproduce this process outside of Stripe.

<!-- TODO(jez) Make these instructions apply outside of Stripe -->

RBI files (sometimes: `*.rbi` files) are "Ruby Interface" files. We can use
`*.rbi` files to tell Sorbet about constants, ancestors, and methods that it
otherwise doesn't know about. By default, Sorbet does **not** know about:

- anything defined within a gem
- ancestors modified with dynamic includes (`other.extend(...)`)
- constants accessed or defined with `const_get` or `const_set`
- methods defined with `define_method` or `method_missing`

`*.rbi` files lie at the intersection of the [static](static.md) and
[dynamic](dynamic.md) features of Sorbet. They can be autogenerated using Ruby's
reflection APIs at runtime, and they help `sorbet` see definitions statically
that it wouldn't otherwise be able to.


## Missing Methods

We autogenerate a bunch of `*.rbi` files to record what methods are dynamically
defined via metaprogramming. To regenerate the missing methods, run this
command:

```bash
scripts/bin/remote-script sorbet/shim_generation/missing_methods.rb
```

This will run on your devbox, take about 5 minutes, and then sync the generated
files back to your laptop. A bunch of files will changed: commit all of them,
even if they don't look related to your changes.

## Gems

Sorbet doesn't read the source code of gems. To know what classes and methods
exist in a gem, Sorbet needs `*.rbi` files for those gems. To regenerate all the
gem-related `*.rbi` files, run this command:

```bash
scripts/bin/remote-script sorbet/shim_generation/gems.rb
```

This will regenerate **every** gem-related `*.rbi` file, which can sometimes
take a while. To regenerate the `*.rbi` files for a specific gem:

```bash
scripts/bin/remote-script sorbet/shim_generation/gems.rb -r MY_GEM
```


## All

Stripe has a number of kinds of `*.rbi` files in addition to those for missing
methods and gems. To regenerate every `*.rbi` file at Stripe, run this command:

```bash
sorbet/shim_generation/all.sh
```

This will take a while.


## Using runtime reflection to find constants

> This section is intended for people trying to adopt Sorbet for the first time.

We can teach Sorbet about some things defined this way using runtime reflection.
The procedure looks like this:

- require everything in a codebase
- use [`ObjectSpace`] (Ruby reflection) to discover what constants exist
- compute the difference between what Sorbet can see statically and what we
  discover through reflection
- serialize the difference into `*.rbi` files

This process is not yet 100% automated outside of Stripe.

[`ObjectSpace`]: https://ruby-doc.org/core-2.4.0/ObjectSpace.html

